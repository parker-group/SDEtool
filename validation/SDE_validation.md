# üß™ Standard Deviational Ellipse (SDE) Validation

This page validates the **R-based SDEtool** against **ArcGIS** and **CrimeStat** using the same dataset (**Lepto**, *n = 24*, WGS84). We report geometric overlap (IoU), angles, centers, and % point coverage. All angles reported here use **clockwise-from-north** (`north_cw`) to match ArcGIS/CrimeStat UI.

---

## üîç Summary of Results

### ArcGIS preset (R) vs ArcGIS shapefiles (1√ó, 2√ó)

| Metric | 1 SD | 2 SD |
|---|---:|---:|
| **IoU (overlap)** | **0.999873** | **0.999873** |
| **Angle Œî (north_cw)** | **0.00027¬∞** | **0.00027¬∞** |
| **Centroid distance** | ‚âà **9√ó10‚Åª‚Å∂¬∞** (‚âà **1 m**) | ‚âà **9√ó10‚Åª‚Å∂¬∞** (‚âà **1 m**) |
| **% points inside (unweighted)** | **75.0000%** | **91.6667%** |
| **Major axis Œî (%)** | **‚àí0.00002%** | **‚àí0.00002%** |
| **Minor axis Œî (%)** | **‚àí0.00074%** | **‚àí0.00074%** |

> **Config:** `mode="arcgis"`, `df = n`, `scale = k¬∑‚àö2`, `angle = north_cw`, computed **in WGS84 degrees**.

---

### CrimeStat preset (R) vs CrimeStat shapefiles (1√ó, 2√ó)

| Metric | 1 SD | 2 SD |
|---|---:|---:|
| **IoU (overlap)** | **0.996356** | **0.993754** |
| **Angle Œî (north_cw)** | **0.062¬∞** | **0.069¬∞** |
| **Centroid distance** | **0.003182¬∞** (‚âà **0.35 km**) | **0.012736¬∞** (‚âà **1.4 km**) |
| **% points inside (unweighted)** | **79.1667%** | **91.6667%** |

> **Config:** `mode="crimestat"`, `df = n‚àí2`, `scale = k¬∑‚àö2`, `angle = north_cw`.  
> Geometry parity with CrimeStat‚Äôs shapefiles is best when computed **in degrees**.  
> **Meters parity** (SDs/areas) is best in a projected CRS (UTM); remaining diffs are within **~0.03‚Äì0.3%**.

---

## üñºÔ∏è Visual Evidence

The panels below use the exact figures generated from the validation runs. Points are shown in black. All figures are in **WGS84 (EPSG:4326)** and framed to the combined extent of ellipses and points.

### R-only comparison (ArcGIS preset vs CrimeStat preset vs Probabilistic)
*These show our three internal approaches on the same points.*

![1√ó compare: ArcGIS vs CrimeStat vs Prob](figures/Compare_1x_Ronly.png)  
**Figure A.** 1√ó SDE comparison. ArcGIS preset (blue), CrimeStat preset (red dashed), Probabilistic 68.27% (green dot-dash). All of these are generated by the R SDEtool.

![2√ó compare: ArcGIS vs CrimeStat vs Prob](figures/Compare_2x_Ronly.png)  
**Figure B.** 2√ó SDE comparison. ArcGIS preset (blue), CrimeStat preset (red dashed), Probabilistic 95% (green dot-dash). All of these are generated by the R SDEtool.

### R-tool (ArcGIS preset in SDEtool) vs ArcGIS shapefiles
*Demonstrates byte-level agreement in degrees.*

![ArcGIS 1√ó: R-tool vs ArcGIS](figures/ArcGIS_R_vs_ArcRef_1x.png)  
**Figure C.** 1√ó: R-tool (blue solid) vs ArcGIS reference (red dashed). IoU ‚âà 0.9999.

![ArcGIS 2√ó: R-tool vs ArcGIS](figures/ArcGIS_R_vs_ArcRef_2x.png)  
**Figure D.** 2√ó: R-tool (blue solid) vs ArcGIS reference (red dashed). IoU ‚âà 0.9999.

### R-tool (CrimeStat preset in SDEtool) vs CrimeStat shapefiles
*Close geometric agreement in degrees; small residual differences expected.*

![CrimeStat 1√ó: R-tool vs CrimeStat](figures/CrimeStat_R_vs_CSRef_1x.png)  
**Figure E.** 1√ó: R-tool (blue solid) vs CrimeStat reference (red dashed). IoU ‚âà 0.996.

![CrimeStat 2√ó: R-tool vs CrimeStat](figures/CrimeStat_R_vs_CSRef_2x.png)  
**Figure F.** 2√ó: R-tool (blue solid) vs CrimeStat reference (red dashed). IoU ‚âà 0.994.

### Probabilistic coverage targets (MVN)
*Inference-oriented option that targets coverage \(p\) under a bivariate normal assumption.*

![Probabilistic ellipses](figures/Prob_ellipses.png)  
**Figure G.** Target coverages 68.27%, 95%, 99.73%. In a single dataset, empirical % inside varies around the targets; across repeated MVN samples, long-run coverage tends to the targets.

---

## üìê Methodology Notes

- **Angle basis:** `north_cw`. Convert to conventional math angle `east_ccw` via `east_ccw = (90 ‚àí north_cw) mod 360`.
- **Containment:** Points on the boundary count as inside.
- **Shapefile DBF fields:** Names may truncate (e.g., `sd_level` ‚Üí `sd_levl`).
- **CRS:** ArcGIS files include a WGS84 `.prj`; CrimeStat output required assigning **EPSG:4326** during plotting.

**Presets implemented in SDEtool**

| Mode        | df used | Scale | Angle basis | Typical use |
|-------------|---------|-------|-------------|-------------|
| `arcgis`    | `n`     | `k¬∑‚àö2` | `north_cw`  | Match ArcGIS (byte-match) |
| `crimestat` | `n‚àí2`   | `k¬∑‚àö2` | `north_cw`  | Match CrimeStat |
| `prob`      | `n‚àí1`   | `‚àö(qchisq(p, df=2))` | `east_ccw` (convert/report as needed) | Target exact coverage \(p\) |

---

## ‚úÖ Takeaways

- **ArcGIS parity** is effectively exact when computed **in degrees** with `df=n`, `k¬∑‚àö2`, `north_cw`.  
- **CrimeStat parity** in degrees is **very close**; meter SDs/areas match CrimeStat‚Äôs text within **~0.03‚Äì0.3%** when computed in a projected CRS.  
- A **probabilistic** mode is available to target exact coverages under MVN assumptions, included here for transparency.
